<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>手机销售系统 - 订单管理</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="../lib/layui-v2.6.3/css/layui.css" media="all">
  <link rel="stylesheet" href="../css/layuimini.css" media="all">
</head>

<body>
  <div class="layui-form layui-form-pane" style="margin: 10px;">
    <div class="layui-form-item">
      <label class="layui-form-label">订单编号</label>
      <div class="layui-input-inline">
        <input type="text" name="orderId" placeholder="请输入订单编号" autocomplete="off" class="layui-input">
      </div>
      <label class="layui-form-label">客户姓名</label>
      <div class="layui-input-inline">
        <input type="text" name="customerName" placeholder="请输入客户姓名" autocomplete="off" class="layui-input">
      </div>
      <label class="layui-form-label">手机型号</label>
      <div class="layui-input-inline">
        <input type="text" name="phoneModel" placeholder="请输入手机型号" autocomplete="off" class="layui-input">
      </div>
      <label class="layui-form-label">订单状态</label>
      <div class="layui-input-inline">
        <select name="orderStatus">
          <option value="">全部状态</option>
          <option value="已完成">已完成</option>
          <option value="处理中">处理中</option>
          <option value="已取消">已取消</option>
        </select>
      </div>
      <div class="layui-input-inline">
        <button class="layui-btn layui-btn-normal" lay-submit lay-filter="search">搜索</button>
      </div>
    </div>
  </div>
  <div>
    <script type="text/html" id="orderTableToolbar">
      <div class="layui-btn-container">
        <button class="layui-btn layui-btn-normal layui-btn-sm data-add-btn" lay-event="add"> 新增订单 </button>
        <button class="layui-btn layui-btn-sm layui-btn-danger data-delete-btn" lay-event="delete"> 批量删除 </button>
        <button class="layui-btn layui-btn-sm layui-btn-primary" lay-event="export"> 导出订单数据 </button>
        <button class="layui-btn layui-btn-sm layui-btn-primary" lay-event="print"> 打印订单 </button>
      </div>
    </script>
    <table class="layui-hide" id="orderTable" lay-filter="orderTableFilter"></table>
    <script type="text/html" id="orderStatus">
      {{#  if(d.status === '已完成'){ }}
      <span class="layui-badge layui-bg-green">已完成</span>
      {{#  } else if(d.status === '处理中') { }}
      <span class="layui-badge layui-bg-orange">处理中</span>
      {{#  } else { }}
      <span class="layui-badge layui-bg-red">已取消</span>
      {{#  } }}
    </script>
    <script type="text/html" id="paymentMethod">
      {{#  if(d.paymentMethod === 'cash'){ }}
      <span>现金</span>
      {{#  } else if(d.paymentMethod === 'alipay') { }}
      <span>支付宝</span>
      {{#  } else if(d.paymentMethod === 'wechat') { }}
      <span>微信支付</span>
      {{#  } else { }}
      <span>银行卡</span>
      {{#  } }}
    </script>
    <script type="text/html" id="orderTableOperation">
      <a class="layui-btn layui-btn-xs data-count-edit" lay-event="edit">编辑</a>
      <a class="layui-btn layui-btn-xs layui-btn-normal" lay-event="view">查看详情</a>
      <a class="layui-btn layui-btn-xs layui-btn-danger data-count-delete" lay-event="delete">删除</a>
      {{#  if(d.status === '处理中'){ }}
      <a class="layui-btn layui-btn-xs layui-btn-primary" lay-event="cancel">取消订单</a>
      {{#  } }}
    </script>
  </div>
  <script src="../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
  <script>
    layui.use(['form', 'table', 'layer'], function () {
      var $ = layui.jquery;
      var form = layui.form;
      var table = layui.table;
      var layer = layui.layer;
      var tableData = [];
      var originalData = [];
      var tableIns = table.render({
        elem: '#orderTable',
        url: 'orders.json',
        toolbar: '#orderTableToolbar',
        defaultToolbar: ['filter', 'exports', 'print', {
          title: '提示',
          layEvent: 'LAYTABLE_TIPS',
          icon: 'layui-icon-tips'
        }],
        cols: [[
          { type: "checkbox", width: 50 },
          { field: 'orderId', width: 160, title: '订单编号', sort: true },
          { field: 'customerName', width: 100, title: '客户姓名', sort: true },
          { field: 'customerPhone', width: 120, title: '联系电话' },
          { field: 'phoneBrand', width: 100, title: '手机品牌', sort: true },
          { field: 'phoneModel', width: 150, title: '手机型号', sort: true },
          { field: 'quantity', width: 80, title: '数量', sort: true },
          { field: 'unitPrice', width: 100, title: '单价(元)', sort: true },
          { field: 'totalPrice', width: 100, title: '总价(元)', sort: true },
          { 
            field: 'paymentMethod', 
            width: 100, 
            title: '支付方式', 
            templet: '#paymentMethod',
            sort: true 
          },
          { field: 'orderDate', width: 150, title: '下单日期', sort: true },
          { 
            field: 'status', 
            width: 100, 
            title: '订单状态', 
            templet: '#orderStatus',
            unresize: true,
            align: "center",
            sort: true 
          },
          { title: '操作', minWidth: 240, toolbar: '#orderTableOperation', align: "center" }
        ]],
        limits: [10, 15, 20, 25, 50, 100],
        limit: 15,
        page: true,
        skin: 'line',
        done: function (res) {
          tableData = JSON.parse(JSON.stringify(res.data));
          originalData = JSON.parse(JSON.stringify(res.data));
        }
      });
      form.on('submit(search)', function (data) {
        var loadingIndex = layer.load(2, {
          shade: [0.1, '#fff']
        });
        tableIns.reload({
          where: data.field,
          page: {
            curr: 1
          },
          done: function (res, curr, count) {
            layer.close(loadingIndex);
            tableData = JSON.parse(JSON.stringify(res.data));
            originalData = JSON.parse(JSON.stringify(res.data));
            layer.open({
              title: '搜索条件',
              content: JSON.stringify(data.field, null, 2),
              btn: ['确定'],
              btnAlign: 'c',
              shade: 0.1,
              area: ['400px', 'auto']
            });
          }
        });
        return false;
      });
      table.on('toolbar(orderTableFilter)', function (obj) {
        if (obj.event === 'add') {
          var index = layer.open({
            title: '新增订单',
            type: 2,
            shade: 0.2,
            maxmin: true,
            shadeClose: true,
            area: ['100%', '100%'],
            content: '../page/ddsc.html'
          });
          $(window).on("resize", function () {
            layer.full(index);
          });
        } else if (obj.event === 'delete') {
          var checkStatus = table.checkStatus('orderTable');
          var selectedData = checkStatus.data;
          if (selectedData.length === 0) {
            layer.msg('请选择需要删除的订单');
            return;
          }
          layer.confirm('确定要删除选中的 ' + selectedData.length + ' 条订单信息吗？', {
            icon: 3
          }, function (index) {
            var selectedIds = selectedData.map(item => String(item.orderId));
            tableData = tableData.filter(item => !selectedIds.includes(String(item.orderId)));
            tableIns.reload({
              data: tableData,
              url: null,
              page: {
                curr: 1
              }
            });
            layer.close(index);
            layer.msg('删除成功，共删除 ' + selectedData.length + ' 条订单信息');
          });
        } else if (obj.event === 'export') {
          layer.confirm('确定要导出所有订单数据吗？', {
            icon: 3
          }, function (index) {
            layer.close(index);
            layer.msg('正在导出订单数据，请稍候...');
          });
        } else if (obj.event === 'print') {
          var checkStatus = table.checkStatus('orderTable');
          var selectedData = checkStatus.data;
          if (selectedData.length === 0) {
            layer.msg('请选择需要打印的订单');
            return;
          }
          layer.confirm('确定要打印选中的 ' + selectedData.length + ' 条订单吗？', {
            icon: 3
          }, function (index) {
            layer.close(index);
            layer.msg('正在准备打印...');
            // 实际应用中这里会调用打印API
          });
        }
      });
      table.on('checkbox(orderTableFilter)', function (obj) {
        console.log("复选框选择:", obj);
      });
      table.on('tool(orderTableFilter)', function (obj) {
        var data = obj.data;
        if (obj.event == 'edit') {
          var index = layer.open({
            title: '编辑订单 - ' + data.orderId,
            type: 2,
            shade: 0.2,
            maxmin: true,
            shadeClose: true,
            area: ['100%', '100%'],
            content: '../page/editorddxx.html'
          });
          $(window).on("resize", function () {
            layer.full(index);
          });
          return false;
        } else if (obj.event == 'view') {
          layer.open({
            title: '订单详情 - ' + data.orderId,
            type: 2,
            shade: 0.2,
            maxmin: true,
            shadeClose: true,
            area: ['800px', '600px'],
            content: '../page/view_order.html?id=' + data.orderId
          });
        } else if (obj.event == 'delete') {
          layer.confirm('您确认删除该订单信息吗？', {
            icon: 3
          }, function (index) {
            obj.del();
            tableData = tableData.filter(item => String(item.orderId) !== String(data.orderId));
            layer.close(index);
            layer.msg('订单信息删除成功');
          });
        } else if (obj.event == 'cancel') {
          layer.confirm('您确认要取消该订单吗？', {
            icon: 3
          }, function (index) {
            // 更新订单状态为已取消
            data.status = '已取消';
            obj.update(data);
            // 更新表格数据
            const idx = tableData.findIndex(item => item.orderId === data.orderId);
            if (idx !== -1) {
              tableData[idx] = data;
            }
            layer.close(index);
            layer.msg('订单已取消');
          });
        }
      });
    });
  </script>
</body>

</html>
    